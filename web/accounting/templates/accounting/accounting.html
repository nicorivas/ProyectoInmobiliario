{% extends "list/base.html" %}
{% block title %}Tasador • Contabilidad{% endblock %}
{% load static %}
{% block head %}
        <link rel="stylesheet" href="{% static 'list/css/main.css' %}">
        {% load static %}
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script src="https://maps.google.com/maps/api/js?key=AIzaSyDgwKrK7tfcd9kCtS9RKSBsM5wYkTuuc7E&libraries=places"></script>
        <script src="{% static 'home/js/google-maps-autocomplete.js' %}"></script>
{% endblock %}

{% block content %}
<div class="container mb-4" style="max-width:100%">

  <div class="row">
    <div class="col-md-1">
    </div>
    <div class="col-md-11">
      <h5 class="mb-4">Contabilidad</h5>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
        <form class="needs-validation" action="/accounting/" method="post" id="form" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        <div class="row mt-4">
          <div class="col-md-2 text-right">
            <p class="font-weight-bold">Búsqueda</p>
          </div>
          <div class="col-md-2">
            <div class="form-group">
              <label>Tasador</label>
              <select name="tasador" class="form-control" required="" id="id_tasador">
                <option value="0">Todos los tasadores</option>
                {% for tasador in tasadores %}
                <option value="{{tasador.id}}">{{tasador.first_name}} {{tasador.last_name}}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-group">
               <label for="id_appraisalTimeRequest">Fecha Inicio</label>
              <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                <input type="text" name="appraisalTimeRequest" class="form-control datetimepicker-input"
                       data-target="#datetimepicker1" required="" id="id_appraisalTimeRequest">
                <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                  <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
              </div>
            </div>
          </div>
          <script type="text/javascript">
            $(function () {
              $('#datetimepicker1').datetimepicker({
                locale: 'es',
                icons: {
                  time: "far fa-clock",
                  date: "far fa-calendar-alt",
                  up: "fas fa-arrow-up",
                  down: "fas fa-arrow-down"
                }
              });
            });
          </script>

          <div class="col-md-2">
            <div class="form-group">
              <label for="id_appraisalTimeRequest2">Fecha Término</label>
              <div class="input-group date" id="datetimepicker2" data-target-input="nearest">
                <input type="text" name="appraisalTimeRequest2" class="form-control datetimepicker-input"
                       data-target="#datetimepicker1" required="" id="id_appraisalTimeRequest2">
                <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker">
                  <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
              </div>
            </div>
          </div>
          <script type="text/javascript">
            $(function () {
              $('#datetimepicker2').datetimepicker({
                locale: 'es',
                icons: {
                  time: "far fa-clock",
                  date: "far fa-calendar-alt",
                  up: "fas fa-arrow-up",
                  down: "fas fa-arrow-down"
                }
              });
            });
          </script>

          <div class="col-md-1">
            <label for="id_ajax_list">&nbsp</label>
            <button class="btn btn-dark btn-block align-bottom ld-ext-left" id="btn_see" type="button">
              Buscar
              <div class="ld ld-ring ld-spin"></div>
            </button>
          </div>
          <div class="col-md-2">
            <label for="id_appraisalTimeRequest">&nbsp</label>
            <button class="btn btn-dark btn-block align-bottom ld-ext-right" id="btn_generate" formmethod="post">
              Exportar
              <div class="ld ld-ring ld-spin"></div>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="card container mb-4" id="div_accounting">
  <div class="card-body">
    <p class="card-title">Previsualización</p>
    <table class="table table-sm  table-accounting"  style="font-size:0.8em;"  id="table_accounting">
          {% include 'accounting/accounting_table.html' %}
    </table>
  </div>
</div>

<script src="{% static 'accounting/js/tools.js' %}" type="text/javascript"></script>

<script src="{% static 'accounting/js/search.js' %}" type="text/javascript"></script>


<script>
   $("#btn_see").on("click", function (event) {
     // Button clicked in the modal. Call an AJAX to load the list
     // for accountability
     var initial = $('#id_appraisalTimeRequest').val();
     var end =  $('#id_appraisalTimeRequest2').val();
     var tasador =  $('#id_tasador').val();
     var url = "{% url 'ajax_accountingView_url' %}";
     btn = $(this);
     btn.addClass('running');
     btn.prop('disabled', true);
     $.ajax({
       url: url,
       type: 'get',
       data: {'initial':initial, 'end':end, 'tasador':tasador},

       error: function () {
           alert("Error al seleccionar vairables.");
           btn.removeClass('running');
           btn.prop('disabled', false);
           return false;
       },
       success: function (data) {
         btn.removeClass('running');
         btn.prop('disabled', false);
         replaceTable("table_accounting",data)
         // assignTableActions()
       }
     });
   });
</script>


{% endblock %}


