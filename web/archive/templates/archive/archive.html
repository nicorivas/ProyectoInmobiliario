{% extends "main/base.html" %}

{% load static %}

{% block head %}

  <link rel="stylesheet" href="{% static 'main/css/table_search.css' %}">

  {% load static %}

{% endblock %}

{% block content %}

{{form_search.media}}

<div class="container" style="max-width:100%">

	<div class="row">
		<div class="col-md-12">
			<h5 class="mb-4">Archivo</h5>
		</div>
	</div>

	<form id="buscar">
        {% csrf_token %}
		<div class="card mb-2" id="div_not_assigned">
			<div class="card-body">
				<div class="row">
					<div class="col-1">
						{{form_search.code.label_tag}}
						{{form_search.code}}
					</div>
					<div class="col-2">
						{{form_search.solicitante.label_tag}}
						{{form_search.solicitante}}
					</div>
					<div class="col-1">
						{{form_search.solicitanteCodigo.label_tag}}
						{{form_search.solicitanteCodigo}}
					</div>
					<div class="col-4">
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-2">
						{{form_search.addressRegion.label_tag}}
						{{form_search.addressRegion}}
					</div>
					<div class="col-2">
						{{form_search.addressCommune.label_tag}}
						{{form_search.addressCommune}}
					</div>
					<div class="col-3">
						{{form_search.addressStreet.label_tag}}
						{{form_search.addressStreet}}
					</div>
					<div class="col-1">
						{{form_search.addressNumber.label_tag}}
						{{form_search.addressNumber}}
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-2">
						{{form_search.tasador.label_tag}}
						{{form_search.tasador}}
					</div>
					<div class="col-2">
						{{form_search.visador.label_tag}}
						{{form_search.visador}}
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-3">
						{{form_search.timeCreatedFrom.label_tag}}
						{{form_search.timeCreatedFrom}}
					</div>
					<div class="col-3">
						{{form_search.timeCreatedUntil.label_tag}}
						{{form_search.timeCreatedUntil}}
					</div>
					<div class="col-3">
						{{form_search.timeFinishedFrom.label_tag}}
						{{form_search.timeFinishedFrom}}
					</div>
					<div class="col-3">
						{{form_search.timeFinishedUntil.label_tag}}
						{{form_search.timeFinishedUntil}}
					</div>
				</div>
			</div>
			<button class="btn btn-dark btn-sm" id="btn_search">
				<div class="text">Buscar</div>
				<div class="loading_text" style="display:none;">...</div>
			</button>
		</div>
	</form>

	{% include 'archive/appraisals.html' %}

</div>

<script src="{% static 'main/js/tools.js' %}" type="text/javascript"></script>

<script>
	$("#btn_search").on('click',function(e) {
		e.preventDefault()
		var btn = $(this)
		btn_loading(btn,hide_text=true)
		var url = "{% url 'ajax_search_url' %}"
    	var form = $('form#buscar')
    	console.log(form)
		$.ajax({
			url: url,
			type: 'post',
			data: form.serialize(),
			error: function() {
				btn_idle(btn)
				alert("Error al buscar.");
			},
			success: function (ret) {
				btn_idle(btn)
				$("table#search").html(ret)
			}
		})
	})
</script>

{% endblock %}
